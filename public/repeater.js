$.fn.repeaterVal=function(){var e,r,n=function(e){if(1===e.length&&(0===e[0].key.length||1===e[0].key.length&&!e[0].key[0]))return e[0].val;foreach(e,function(e){e.head=e.key.shift()});var t,a,r=(t={},foreach(e,function(e){t[e.head]||(t[e.head]=[]),t[e.head].push(e)}),t);return/^[0-9]+$/.test(e[0].head)?(a=[],foreach(r,function(e){a.push(n(e))})):(a={},foreach(r,function(e,t){a[t]=n(e)})),a};return n((e=$(this).inputVal(),r=[],foreach(e,function(e,t){var a=[];"undefined"!==t&&(a.push(t.match(/^[^\[]*/)[0]),a=a.concat(map(t.match(/\[[^\]]*\]/g),function(e){return e.replace(/[\[\]]/g,"")})),r.push({val:e,key:a}))}),r))},$.fn.repeater=function(m){var v;return m=m||{},$(this).each(function(){var e=$(this),a=m.show||function(){$(this).show()},t=m.hide||function(e){e()},r=e.find("[data-repeater-list]").first(),s=function(e,t){return e.filter(function(){return!t||0===$(this).closest(pluck(t,"selector").join(",")).length})},n=function(){return s(r.find("[data-repeater-item]"),m.repeaters)},i=r.find("[data-repeater-item]").first().clone().hide(),c=s(s($(this).find("[data-repeater-item]"),m.repeaters).first().find("[data-repeater-delete]"),m.repeaters);m.isFirstItemUndeletable&&c&&c.remove();var f=function(){var e=r.data("repeater-list");return m.$parent?m.$parent.data("item-name")+"["+e+"]":e},o=function(e){m.repeaters&&e.each(function(){var t=$(this);foreach(m.repeaters,function(e){t.find(e.selector).repeater(extend(e,{$parent:t}))})})},u=function(e,t,a){e&&foreach(e,function(e){a.call(t.find(e.selector)[0],e)})},d=function(e,c,f){e.each(function(n){var i=$(this);i.data("item-name",c+"["+n+"]"),s(i.find("[name]"),f).each(function(){var e=$(this),t=e.attr("name").match(/\[[^\]]+\]/g),a=t?last(t).replace(/\[|\]/g,""):e.attr("name"),r=c+"["+n+"]["+a+"]"+(e.is(":checkbox")||e.attr("multiple")?"[]":"");e.attr("name",r),u(f,i,function(e){var t=$(this);d(s(t.find("[data-repeater-item]"),e.repeaters||[]),c+"["+n+"]["+t.find("[data-repeater-list]").first().data("repeater-list")+"]",e.repeaters)})})}),r.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};d(n(),f(),m.repeaters),o(n()),m.initEmpty&&n().remove(),m.ready&&m.ready(function(){d(n(),f(),m.repeaters)});var h,p=(h=function(e,t,a){if(t||m.defaultValues){var r={};s(e.find("[name]"),a).each(function(){var e=$(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];r[e]=$(this).attr("name")}),e.inputVal(map(filter(t||m.defaultValues,function(e,t){return r[t]}),identity,function(e){return r[e]}))}u(a,e,function(r){var n=$(this);s(n.find("[data-repeater-item]"),r.repeaters).each(function(){var e=n.find("[data-repeater-list]").data("repeater-list");if(t&&t[e]){var a=$(this).clone();n.find("[data-repeater-item]").remove(),foreach(t[e],function(e){var t=a.clone();h(t,e,r.repeaters||[]),n.find("[data-repeater-list]").append(t)})}else h($(this),r.defaultValues,r.repeaters||[])})})},function(e,t){r.append(e),d(n(),f(),m.repeaters),e.find("[name]").each(function(){$(this).inputClear()}),h(e,t||m.defaultValues,m.repeaters)}),l=function(e){var t=i.clone();p(t,e),m.repeaters&&o(t),a.call(t.get(0))};v=function(e){n().remove(),foreach(e,l)},s(e.find("[data-repeater-create]"),m.repeaters).click(function(){l()}),r.on("click","[data-repeater-delete]",function(){var e=$(this).closest("[data-repeater-item]").get(0);t.call(e,function(){$(e).remove(),d(n(),f(),m.repeaters)})})}),this.setList=v,this};